<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Fitness Dashboard</title>
    <!-- Fonts and Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/feather-icons"></script>
    <!-- Main Stylesheet -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/new_dashboard_style.css') }}"
    />
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <div class="dashboard-wrapper">
      <!-- ==== Sidebar Navigation ==== -->
      <nav class="sidebar">
        <div class="sidebar-header">
          <i data-feather="activity"></i>
          <span>FitCo</span>
        </div>
        <ul class="sidebar-links">
          <li class="active">
            <a href="{{ url_for('new_dashboard') }}"
              ><i data-feather="grid"></i><span>Dashboard</span></a
            >
          </li>
          <li>
            <a href="{{ url_for('select_exercise') }}"
              ><i data-feather="video"></i><span>Workouts</span></a
            >
          </li>
          <li>
            <a href="{{ url_for('history') }}"
              ><i data-feather="clock"></i><span>History</span></a
            >
          </li>
          <li>
            <a href="{{ url_for('settings') }}"
              ><i data-feather="settings"></i><span>Settings</span></a
            >
          </li>
        </ul>
        <ul class="sidebar-footer">
          <li>
            <a href="{{ url_for('profile') }}"
              ><i data-feather="user"></i><span>Profile</span></a
            >
          </li>
          <li>
            <a href="{{ url_for('logout') }}"
              ><i data-feather="log-out"></i><span>Logout</span></a
            >
          </li>
        </ul>
      </nav>

      <!-- ==== Main Content ==== -->
      <main class="main-content">
        <!-- Main Header -->
        <header class="main-header">
          <div class="header-greeting">
            <h1>Welcome back, {{ user.nickname or user.username }}!</h1>
            <p>Let's crush your goals today ðŸ’ª</p>
            <div class="header-separator"></div>
          </div>
        </header>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
          <!-- Profile Card -->
          <div class="card profile-card">
            <div class="profile-header">
              <img
                src="{{ url_for('static', filename=user.profile_image.replace('static/', '')) if user.profile_image else url_for('static', filename='uploads/default.png') }}"
                alt="User"
                class="profile-avatar"
              />
              <div class="profile-info">
                <h2>{{ user.nickname or user.username }}</h2>
                <p>Fitness Goal: {{ user.level or 'Beginner' }}</p>
              </div>
            </div>
            <div class="profile-stats">
              <div class="stat-item">
                <span>Level</span>
                <strong>{{ user.level or 'N/A' }}</strong>
              </div>
              <div class="stat-item">
                <span>Workouts</span>
                <strong id="workoutsCount">{{ workouts }}</strong>
              </div>
            </div>
          </div>

          <!-- Workout Summary -->
          <div class="card workout-summary-card">
            <h3>Today's Summary</h3>
            <div class="summary-grid">
              <div class="summary-item">
                <i data-feather="repeat"></i><span>Reps</span>
                <strong id="summary-reps">{{ total_reps }}</strong>
              </div>
              <div class="summary-item">
                <i data-feather="layers"></i><span>Sets</span>
                <strong id="summary-sets">{{ total_sets }}</strong>
              </div>
              <div class="summary-item">
                <i data-feather="clock"></i><span>Duration</span>
                <strong id="summary-duration">{{ total_duration }}s</strong>
              </div>
              <div class="summary-item">
                <i data-feather="zap"></i><span>Calories</span>
                <strong id="summary-calories">{{ calories }}</strong>
              </div>
            </div>
            <div class="progress-bar-container">
              <div
                id="summary-progress-bar"
                class="progress-bar"
                style="width: 0%"
              ></div>
            </div>
          </div>

          <!-- Accuracy -->
          <div class="card accuracy-card">
            <h3>Exercise Accuracy</h3>
            <div class="progress-ring">
              <svg class="progress-ring-svg">
                <circle
                  class="progress-ring-circle-bg"
                  cx="80"
                  cy="80"
                  r="70"
                ></circle>
                <circle
                  class="progress-ring-circle"
                  cx="80"
                  cy="80"
                  r="70"
                  style="--value: {{ accuracy|default(0) }}"
                ></circle>
              </svg>
              <div id="accuracy-text" class="progress-ring-text">
                {{ accuracy|default(0) }}%
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script src="{{ url_for('static', filename='js/new_dashboard_script.js') }}"></script>
    <script>
      feather.replace();

      // Live update from /dashboard_data every 5s
      async function updateDashboard() {
        try {
          const res = await fetch("/dashboard_data");
          const data = await res.json();
          document.getElementById("summary-reps").textContent =
            data.daily_summary.reps;
          document.getElementById("summary-sets").textContent =
            data.daily_summary.sets;
          document.getElementById("summary-duration").textContent =
            data.daily_summary.duration + "s";
          document.getElementById("summary-calories").textContent =
            data.daily_summary.calories;

          // Update accuracy ring and text
          const accuracyText = document.getElementById("accuracy-text");
          accuracyText.textContent = `${data.accuracy}%`;

          const ring = document.querySelector(".progress-ring-circle");
          ring.style.setProperty("--value", data.accuracy);

          // Update live progress bar for active workout
          const bar = document.getElementById("summary-progress-bar");
          bar.style.width = data.live_summary.progress + "%";
        } catch (err) {
          console.error("Error updating dashboard:", err);
        }
      }
      setInterval(updateDashboard, 5000);
      updateDashboard();
    </script>
  </body>
</html>
